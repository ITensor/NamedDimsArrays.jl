name: "IntegrationTest"
on:
  push:
    branches:
      - "main"
    tags: "*"
    paths:
      - "Project.toml"
  pull_request:
    types:
      - "opened"
      - "synchronize"
      - "reopened"
      - "ready_for_review"
      - "converted_to_draft"
jobs:
  integration-test:
    name: "IntegrationTest"
    strategy:
      matrix:
        pkg:
          - "DiagonalArrays"
          - "GradedArrays"
          - "ITensorBase"
          - "ITensorNetworksNext"
          - "SparseArraysBase"
    uses: "ITensor/ITensorActions/.github/workflows/IntegrationTest.yml@main"
    with:
      localregistry: "https://github.com/ITensor/ITensorRegistry.git"
      pkg: "${{ matrix.pkg }}"
  integrationtests-gate:
    name: "IntegrationTest"
    needs: "integrationtests"
    if: "${{ always() }}"
    runs-on: "ubuntu-latest"
    steps:
      - name: "Fail if any matrix leg failed"
        run: |
          echo "integrationtests.result = ${{ needs.integrationtests.result }}"
          test "${{ needs.integrationtests.result }}" = "success"
          
